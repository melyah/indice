// Base de conocimientos de maquillaje
const makeupTopics = [
    {
        id: 'base',
        title: 'Base y Piel',
        keywords: ['base', 'foundation', 'corrector', 'piel', 'primer', 'polvo', 'contouring', 'contorno'],
        responses: [
            '‚ú® Para una base perfecta, aplica primer primero, luego foundation con movimientos circulares y sella con polvo transl√∫cido.',
            'üíÑ El corrector debe ser un tono m√°s claro que tu piel. Apl√≠calo en tri√°ngulo bajo los ojos y difumina hacia afuera.',
            'üåü Para contouring natural, usa un tono 2 sombras m√°s oscuro que tu piel en los huecos de las mejillas y difumina bien.',
            '‚ú® El primer es clave para que el maquillaje dure m√°s. Apl√≠calo despu√©s del hidratante y antes de la base.',
            'üí´ Para piel grasa, usa base oil-free y sella con polvo. Para piel seca, hidrata bien antes de aplicar base.'
        ]
    },
    {
        id: 'ojos',
        title: 'Maquillaje de Ojos',
        keywords: ['ojos', 'sombras', 'delineador', 'pesta√±as', 'cejas', 'smokey', 'cut crease', 'mascara'],
        responses: [
            'üëÅÔ∏è Para un smokey eye b√°sico: aplica sombra oscura en el p√°rpado m√≥vil, difumina hacia arriba y agrega brillo en el lagrimal.',
            '‚ú® Delineador perfecto: comienza desde el centro del ojo hacia afuera, luego del centro hacia el lagrimal para mejor control.',
            'üé® Para cejas naturales: cepilla hacia arriba, rellena espacios vac√≠os con trazos como pelos y fija con gel transparente.',
            'üí´ Para ojos peque√±os: usa sombras claras en el p√°rpado m√≥vil y oscuras solo en el pliegue externo.',
            'üåü Truco para pesta√±as largas: aplica m√°scara en zigzag desde la ra√≠z hasta las puntas, deja secar y aplica segunda capa.'
        ]
    },
    {
        id: 'labios',
        title: 'Labios',
        keywords: ['labios', 'lipstick', 'gloss', 'nude', 'rojo', 'perfilador', 'mate', 'brillo'],
        responses: [
            'üíã Para labios perfectos: exfolia, hidrata, aplica perfilador y luego el color desde el centro hacia afuera.',
            '‚ú® Labios m√°s voluminosos: usa perfilador ligeramente m√°s oscuro que el labial y agrega gloss en el centro.',
            'üåπ Para que el labial dure m√°s: aplica base, luego labial, presiona con papel tissue y aplica otra capa.',
            'üíÑ Labios mate sin resequedad: hidrata bien antes, aplica b√°lsamo, retira exceso y luego el labial mate.',
            '‚ú® Para labios finos: usa perfilador un poco fuera del borde natural y rellena con color claro.'
        ]
    },
    {
        id: 'productos',
        title: 'Recomendaciones',
        keywords: ['producto', 'recomendaci√≥n', 'marca', 'precio', 'drugstore', 'high end', 'barato', 'caro'],
        responses: [
            'üõçÔ∏è Para principiantes recomiendo: base de L\'Or√©al, sombras de Maybelline, mascara de Essence y labiales de Revlon.',
            'üíé Productos de farmacia incre√≠bles: Corrector de Maybelline Fit Me, rubor de Milani, delineador de NYX.',
            '‚ú® Inversi√≥n que vale la pena: una buena base, brochas de calidad y un buen corrector son la clave del maquillaje perfecto.',
            'üåü Marcas accesibles y buenas: Essence, Catrice, NYX, Maybelline, L\'Or√©al y Revlon tienen excelente calidad-precio.',
            'üí´ Para brochas: Real Techniques y EcoTools son marcas asequibles con excelente calidad.'
        ]
    },
    {
        id: 'tutoriales',
        title: 'Tutoriales',
        keywords: ['tutorial', 'paso a paso', 'como hacer', 'ense√±ar', 'aprender', 'principiante'],
        responses: [
            'üìö Tutorial b√°sico diario: 1) Primer 2) Base 3) Corrector 4) Polvo 5) Rubor 6) M√°scara 7) Labial nude',
            'üéØ Look de noche paso a paso: 1) Smokey eye 2) Delineador grueso 3) Pesta√±as postizas 4) Contouring 5) Labial rojo',
            '‚ú® Maquillaje natural: usa base ligera, rubor durazno, m√°scara marr√≥n y labial nude rosado.',
            'üåü Para eventos: intensifica ojos con sombras met√°licas, usa delineador l√≠quido y labial de larga duraci√≥n.',
            'üíÑ Look rom√°ntico: sombras rosadas, rubor coral, labios en tonos berry y pesta√±as bien definidas.'
        ]
    }
];

const quickSuggestions = [
    '¬øC√≥mo hacer un smokey eye?',
    'Rutina de maquillaje diaria',
    'Productos para principiantes',
    'Maquillaje para ojos peque√±os',
    'Labios mate que no resequen',
    'Contouring para rostro redondo',
    'Base para piel grasa',
    'Cejas perfectas paso a paso',
    'Maquillaje de noche elegante',
    'Productos de farmacia buenos'
];

// Variables globales
let messageCounter = 0;
let isTyping = false;

// Inicializaci√≥n
document.addEventListener('DOMContentLoaded', function() {
    // Configurar tiempo inicial
    document.getElementById('initialTime').textContent = getCurrentTime();
    
    // Event listeners
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');
    
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    messageInput.addEventListener('input', function() {
        sendBtn.disabled = !this.value.trim();
    });
    
    // Inicializar bot√≥n como deshabilitado
    sendBtn.disabled = true;
});

// Funci√≥n para obtener tiempo actual
function getCurrentTime() {
    return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

// Funci√≥n para enviar mensaje
function sendMessage() {
    const messageInput = document.getElementById('messageInput');
    const message = messageInput.value.trim();
    
    if (!message || isTyping) return;
    
    // Limpiar input
    messageInput.value = '';
    document.getElementById('sendBtn').disabled = true;
    
    // Agregar mensaje del usuario
    addUserMessage(message);
    
    // Mostrar indicador de escritura
    showTypingIndicator();
    
    // Simular respuesta del bot
    setTimeout(() => {
        hideTypingIndicator();
        const botResponse = getBotResponse(message);
        addBotMessage(botResponse);
    }, 1000 + Math.random() * 1500);
}

// Funci√≥n para enviar sugerencia
function sendSuggestion(suggestion) {
    if (isTyping) return;
    
    addUserMessage(suggestion);
    showTypingIndicator();
    
    setTimeout(() => {
        hideTypingIndicator();
        const botResponse = getBotResponse(suggestion);
        addBotMessage(botResponse);
    }, 800 + Math.random() * 1000);
}

// Funci√≥n para agregar mensaje del usuario
function addUserMessage(text) {
    const messagesContainer = document.getElementById('chatMessages');
    const messageId = ++messageCounter;
    
    const messageHTML = `
        <div class="message user-message" id="message-${messageId}">
            <div class="message-avatar">
                <svg class="user-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            </div>
            <div class="message-content">
                <div class="message-bubble">
                    <p>${text}</p>
                    <span class="message-time">${getCurrentTime()}</span>
                </div>
            </div>
        </div>
    `;
    
    messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
    scrollToBottom();
}

// Funci√≥n para agregar mensaje del bot
function addBotMessage(text) {
    const messagesContainer = document.getElementById('chatMessages');
    const messageId = ++messageCounter;
    const showSuggestions = Math.random() > 0.6;
    
    let suggestionsHTML = '';
    if (showSuggestions) {
        const randomSuggestions = getRandomSuggestions(2);
        suggestionsHTML = `
            <div class="suggestions">
                <p class="suggestions-title">Sugerencias:</p>
                ${randomSuggestions.map(suggestion => 
                    `<button class="suggestion-btn" onclick="sendSuggestion('${suggestion}')">${suggestion}</button>`
                ).join('')}
            </div>
        `;
    }
    
    const messageHTML = `
        <div class="message bot-message" id="message-${messageId}">
            <div class="message-avatar">
                <svg class="bot-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8V4H8"/>
                    <rect width="16" height="12" x="4" y="8" rx="2"/>
                    <path d="M2 14h2"/>
                    <path d="M20 14h2"/>
                    <path d="M15 13v2"/>
                    <path d="M9 13v2"/>
                </svg>
            </div>
            <div class="message-content">
                <div class="message-bubble">
                    <p>${text}</p>
                    <span class="message-time">${getCurrentTime()}</span>
                </div>
                ${suggestionsHTML}
            </div>
        </div>
    `;
    
    messagesContainer.insertAdjacentHTML('beforeend', messageHTML);
    scrollToBottom();
}

// Funci√≥n para obtener respuesta del bot
function getBotResponse(userMessage) {
    const lowerMessage = userMessage.toLowerCase();
    
    // Buscar en los temas de maquillaje
    for (const topic of makeupTopics) {
        for (const keyword of topic.keywords) {
            if (lowerMessage.includes(keyword)) {
                const randomIndex = Math.floor(Math.random() * topic.responses.length);
                return topic.responses[randomIndex];
            }
        }
    }
    
    // Respuestas para saludos y agradecimientos
    if (lowerMessage.includes('hola') || lowerMessage.includes('hi') || lowerMessage.includes('buenas')) {
        return '¬°Hola preciosa! üíñ ¬øEn qu√© aspecto del maquillaje te gustar√≠a que te ayude hoy?';
    }
    
    if (lowerMessage.includes('gracias') || lowerMessage.includes('thank')) {
        return '¬°De nada! üòä Siempre estoy aqu√≠ para ayudarte a lucir radiante. ¬øHay algo m√°s en lo que pueda asistirte?';
    }
    
    if (lowerMessage.includes('adi√≥s') || lowerMessage.includes('bye') || lowerMessage.includes('chau')) {
        return '¬°Hasta luego, hermosa! üíÑ‚ú® Que tengas un d√≠a radiante. ¬°Vuelve cuando quieras m√°s consejos de maquillaje!';
    }
    
    // Respuestas espec√≠ficas
    if (lowerMessage.includes('principiante') || lowerMessage.includes('empezar') || lowerMessage.includes('comenzar')) {
        return 'üåü ¬°Perfecto para empezar! Te recomiendo comenzar con: 1) Una buena base 2) Corrector 3) M√°scara de pesta√±as 4) Un labial nude. ¬øTe gustar√≠a consejos espec√≠ficos para alguno?';
    }
    
    if (lowerMessage.includes('rutina') || lowerMessage.includes('diario') || lowerMessage.includes('d√≠a')) {
        return '‚ú® Rutina diaria perfecta: 1) Limpia e hidrata 2) Primer 3) Base ligera 4) Corrector 5) Polvo transl√∫cido 6) Rubor sutil 7) M√°scara 8) Labial nude. ¬°Simple y efectiva!';
    }
    
    if (lowerMessage.includes('noche') || lowerMessage.includes('fiesta') || lowerMessage.includes('evento')) {
        return 'üåô Para la noche intensifica: smokey eyes, delineador marcado, pesta√±as dram√°ticas, contouring definido y labial statement. ¬°Ser√°s el centro de atenci√≥n!';
    }
    
    // Respuesta por defecto
    const defaultResponses = [
        '‚ú® ¬°Interesante pregunta! Te recomiendo ser m√°s espec√≠fica. Puedo ayudarte con maquillaje de ojos, labios, base, contouring, recomendaciones de productos y mucho m√°s. ¬øQu√© te interesa saber?',
        'üíÑ Me encanta ayudarte con el maquillaje. ¬øPodr√≠as ser m√°s espec√≠fica? Puedo darte consejos sobre t√©cnicas, productos, tutoriales paso a paso y mucho m√°s.',
        'üåü ¬°Estoy aqu√≠ para ayudarte! Cu√©ntame m√°s detalles sobre lo que necesitas: ¬øes para el d√≠a o la noche? ¬øBuscas algo natural o m√°s dram√°tico?'
    ];
    
    return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
}

// Funci√≥n para obtener sugerencias aleatorias
function getRandomSuggestions(count) {
    const shuffled = [...quickSuggestions].sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
}

// Funci√≥n para mostrar indicador de escritura
function showTypingIndicator() {
    isTyping = true;
    const typingIndicator = document.getElementById('typingIndicator');
    typingIndicator.style.display = 'flex';
    scrollToBottom();
}

// Funci√≥n para ocultar indicador de escritura
function hideTypingIndicator() {
    isTyping = false;
    const typingIndicator = document.getElementById('typingIndicator');
    typingIndicator.style.display = 'none';
}

// Funci√≥n para hacer scroll al final
function scrollToBottom() {
    const messagesContainer = document.getElementById('chatMessages');
    setTimeout(() => {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }, 100);
}